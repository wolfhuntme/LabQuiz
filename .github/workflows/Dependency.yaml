name: 2. OWASP Dependency Check

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  dependency-check:
    name: OWASP Dependency Check
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.1'
        tools: composer
        
    - name: Create composer.json with dependencies
      run: |
        cat > composer.json << 'EOF'
        {
          "name": "secure-webapp/search-app",
          "require": {
            "php": ">=8.1"
          },
          "require-dev": {
            "phpunit/phpunit": "^10.0"
          }
        }
        EOF
        
    - name: Install dependencies
      run: composer install --no-interaction
      
    - name: Run OWASP Dependency Check
      uses: dependency-check/Dependency-Check_Action@main
      with:
        project: "SecureWebApp"
        path: "."
        format: "HTML,JSON"
        out: "reports"
        
    - name: Upload dependency check report
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: dependency-check-report
        path: reports/
        
    - name: Show dependency check summary
      run: |
        echo "âœ… OWASP Dependency Check completed"
        if [ -f reports/dependency-check-report.html ]; then
          echo "ðŸ“Š HTML report generated successfully"
          ls -la reports/
        fi